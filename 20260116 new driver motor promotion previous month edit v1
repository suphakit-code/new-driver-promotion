DROP TEMPORARY TABLE motor_driver ;


CREATE TEMPORARY TABLE motor_driver
SELECT p.promo_id,
	ROW_NUMBER() OVER(PARTITION BY d.skootar_id ORDER BY p.promo_id) AS promo_num,
	d.id,
	date(DATE_ADD(f.first_order_date,INTERVAL 30 DAY)) AS end_promo_date,
	p.promo_type,
	d.skootar_id,
	ev.evidence_status,
	if(ev.evidence_status =1,'‡∏™‡πà‡∏á‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡∏∞‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß', if(ev.evidence_status =9, '‡∏¢‡∏±‡∏á‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö', '‡∏¢‡∏±‡∏á‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥') ) AS status_doc,
	date(f.first_order_date) AS first_order_date,
	if(ev.evidence_status =1,'', date(DATE_ADD(f.first_order_date,INTERVAL 30 DAY))) AS expired_send_doc_date,
	if(CURRENT_DATE() BETWEEN d.start_datetime AND d.end_datetime , 	ROW_NUMBER() OVER(PARTITION BY d.skootar_id ORDER BY p.promo_id),NULL) AS current_stage,
	if(CURRENT_DATE() BETWEEN d.start_datetime AND d.end_datetime , 	 CONCAT(DATE_FORMAT(d.start_datetime, '%d/%m'), ' - ', DATE_FORMAT(d.end_datetime, '%d/%m'))   ,NULL) AS current_duration,
	COUNT(if(CURRENT_DATE() BETWEEN d.start_datetime AND d.end_datetime AND j.job_status >=9,j.job_id,NULL)) AS current_job,
	round(if(COUNT(if(CURRENT_DATE() BETWEEN d.start_datetime AND d.end_datetime AND j.job_status >=9,j.job_id,NULL)) >=p.min_count_job,p.bonus_amount,0),0) AS current_bonus,
	
	d.start_datetime,
	d.end_datetime,
	p.min_count_job,
	p.bonus_amount,
	COUNT(if(j.job_status>=9,j.job_id,NULL)) AS total_order,
	COUNT(distinct if(j.job_status>=9,j.created_by,NULL)) AS total_user,
	round(if(COUNT(if(j.job_status>=9,j.job_id,NULL)) >=p.min_count_job,p.bonus_amount,0),0) AS total_bonus,
	SUM(m.pay_skootar) AS pay_skootar,
	d.bonus_status
FROM tbl_driver_promotion p LEFT JOIN tbl_driver_promotion_detail d ON p.promo_id = d.promo_id
	LEFT JOIN tbl_job j ON d.skootar_id = j.stootar_id
			AND j.date_src BETWEEN d.start_datetime AND d.end_datetime
	LEFT JOIN tbl_mission m ON j.mission_id = m.mission_id
   LEFT JOIN tbl_skootar_evidence ev ON d.skootar_id = ev.skootar_id
   LEFT JOIN tbl_driver_first_order f ON d.skootar_id = f.skootar_id
   LEFT JOIN tbl_skootar s ON d.skootar_id = s.skootar_id
   
WHERE p.start_date >= DATE_FORMAT(DATE_SUB(CURRENT_DATE(),INTERVAL 1 MONTH),'%Y-%m-%01 00:00:00') 
	AND p.start_date < DATE_FORMAT(date_add(LAST_DAY(DATE_SUB(CURRENT_DATE(),INTERVAL 1 MONTH)) ,INTERVAL 1 DAY),'%Y-%m-%d 00:00:00')
	AND p.promo_type LIKE '%new_driver%'
	AND p.vehicle_type ='motorcycle'
	AND s.`status` >-1
GROUP BY p.promo_id,d.skootar_id;


SELECT *
FROM motor_driver;


-- cut off expired send doc date
SELECT m.promo_id,
	m.skootar_id,
	m.evidence_status,
	 CONCAT_WS('',
    	CONCAT('update tbl_driver_promotion_detail set total_count_job = ',m.promo_id,', '),
    	CONCAT('total_user = ',m.total_user ,', '),
    	CONCAT('total_pay_skootar = ',m.pay_skootar ,', '),
    	CONCAT('result_bonus = ',m.total_bonus,', '),
    	CONCAT('bonus_status = 0'),
    	CONCAT(' where skootar_id =\'',m.skootar_id,'\' and promo_id =',m.promo_id,';')) AS update_promo,
   m.end_promo_date
FROM motor_driver m
WHERE m.evidence_status =10
	AND m.bonus_status =1
	AND m.expired_send_doc_date < CURRENT_DATE()
	AND m.end_promo_date < CURRENT_DATE() ;


-- add bonus
SELECT m.promo_id,
	'Bonus' AS trans_type,
	 CONCAT (m.id ,' ‡πÇ‡∏õ‡∏£‡∏Ø‡∏¢‡∏¥‡πà‡∏á‡∏ß‡∏¥‡πà‡∏á‡∏¢‡∏¥‡πà‡∏á‡πÑ‡∏î‡πâ‡πÇ‡∏ö‡∏ô‡∏±‡∏™ 5 ‡∏ï‡πà‡∏≠ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ', m.first_order_date,' ‡∏ñ‡∏∂‡∏á ', m.end_datetime,
	  ' ‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡πà',m.promo_num,' ‡∏ß‡∏¥‡πà‡∏á‡πÑ‡∏õ ',m.total_order, ' ‡∏á‡∏≤‡∏ô ‡πÑ‡∏î‡πâ‡πÇ‡∏ö‡∏ô‡∏±‡∏™ ',m.total_bonus ,' ‡∏ö‡∏≤‡∏ó') AS description,
    m.skootar_id, 
    '' AS mission_id,
    if(m.promo_num<=5,m.total_bonus,0) AS adjust_deposit,
    0,
    0,
    0,
    'Top' AS added_by,
	 CONCAT_WS('',
    	CONCAT('update tbl_driver_promotion_detail set total_count_job = ',m.promo_id,', '),
    	CONCAT('total_user = ',m.total_user ,', '),
    	CONCAT('total_pay_skootar = ',m.pay_skootar ,', '),
    	CONCAT('result_bonus = ',if(m.promo_num<=5,m.total_bonus,0),', '),
    	CONCAT('bonus_status = ',if(m.total_bonus >0,2,0)),
    	CONCAT(' where skootar_id =\'',m.skootar_id,'\' and promo_id =',m.promo_id,';')) AS update_promo,
   m.end_promo_date
FROM motor_driver m
WHERE m.bonus_status =1 
		AND m.evidence_status =1
	AND m.end_promo_date < CURRENT_DATE() ;


-- noti add bonus
SELECT m.skootar_id,
	s.onesignal_id,
	'üì£‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πà‡∏á‡∏á‡∏≤‡∏ô ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏¢‡∏¥‡πà‡∏á‡∏ß‡∏¥‡πà‡∏á ‡∏¢‡∏¥‡πà‡∏á‡πÑ‡∏î‡πâ ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏∏‡∏ìüèçÔ∏è' AS heading_en,
   'üì£‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πà‡∏á‡∏á‡∏≤‡∏ô ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏¢‡∏¥‡πà‡∏á‡∏ß‡∏¥‡πà‡∏á ‡∏¢‡∏¥‡πà‡∏á‡πÑ‡∏î‡πâ ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏∏‡∏ìüèçÔ∏è' AS heading_th,
   
'üí∏‡∏™‡∏£‡∏∏‡∏õ‡πÇ‡∏õ‡∏£‡∏Ø ‡∏¢‡∏¥‡πà‡∏á‡∏ß‡∏¥‡πà‡∏á ‡∏¢‡∏¥‡πà‡∏á‡πÑ‡∏î‡πâ ‡πÇ‡∏ö‡∏ô‡∏±‡∏™ 5 ‡∏ï‡πà‡∏≠' AS heading_th,
	'üí∏‡∏™‡∏£‡∏∏‡∏õ‡πÇ‡∏õ‡∏£‡∏Ø ‡∏¢‡∏¥‡πà‡∏á‡∏ß‡∏¥‡πà‡∏á ‡∏¢‡∏¥‡πà‡∏á‡πÑ‡∏î‡πâ ‡πÇ‡∏ö‡∏ô‡∏±‡∏™ 5 ‡∏ï‡πà‡∏≠' AS heading_en,


	CONCAT('‡∏û‡∏µ‡πà',s.first_name,' ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ',m.first_order_date,' ‡∏ñ‡∏∂‡∏á ',MAX(CASE WHEN m.promo_num = 5 THEN date(m.end_datetime) END) ,
	  '<br/>‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡πà 1 ‡∏ß‡∏¥‡πà‡∏á‡πÑ‡∏õ ',MAX(CASE WHEN m.promo_num = 1 THEN m.total_order END), ' ‡∏á‡∏≤‡∏ô ‡πÑ‡∏î‡πâ‡πÇ‡∏ö‡∏ô‡∏±‡∏™ ', MAX(CASE WHEN m.promo_num = 1 THEN m.total_bonus END) ,' ‡∏ö‡∏≤‡∏ó', 
	  '<br/>‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡πà 2 ‡∏ß‡∏¥‡πà‡∏á‡πÑ‡∏õ ',MAX(CASE WHEN m.promo_num = 2 THEN m.total_order END),' ‡∏á‡∏≤‡∏ô ‡πÑ‡∏î‡πâ‡πÇ‡∏ö‡∏ô‡∏±‡∏™ ', MAX(CASE WHEN m.promo_num = 2 THEN m.total_bonus END) ,' ‡∏ö‡∏≤‡∏ó',
	  '<br/>‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡πà 3 ‡∏ß‡∏¥‡πà‡∏á‡πÑ‡∏õ ', MAX(CASE WHEN m.promo_num = 3 THEN m.total_order END),' ‡∏á‡∏≤‡∏ô ‡πÑ‡∏î‡πâ‡πÇ‡∏ö‡∏ô‡∏±‡∏™ ', MAX(CASE WHEN m.promo_num = 3 THEN m.total_bonus END) ,' ‡∏ö‡∏≤‡∏ó',
      '<br/>‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡πà 3 ‡∏ß‡∏¥‡πà‡∏á‡πÑ‡∏õ ', MAX(CASE WHEN m.promo_num = 4 THEN m.total_order END),' ‡∏á‡∏≤‡∏ô ‡πÑ‡∏î‡πâ‡πÇ‡∏ö‡∏ô‡∏±‡∏™ ', MAX(CASE WHEN m.promo_num = 4 THEN m.total_bonus END) ,' ‡∏ö‡∏≤‡∏ó',
      '<br/>‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡πà 3 ‡∏ß‡∏¥‡πà‡∏á‡πÑ‡∏õ ', MAX(CASE WHEN m.promo_num = 5 THEN m.total_order END),' ‡∏á‡∏≤‡∏ô ‡πÑ‡∏î‡πâ‡πÇ‡∏ö‡∏ô‡∏±‡∏™ ', MAX(CASE WHEN m.promo_num = 5 THEN m.total_bonus END) ,' ‡∏ö‡∏≤‡∏ó', 
	  '<br/>‡∏£‡∏ß‡∏°‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ', SUM(m.total_bonus),' ‡∏ö‡∏≤‡∏ó'
	  '<br/>‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏ì ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà',DATE_FORMAT(now(), '%d/%m/%Y %H:%i')) AS contents_th,
	  
	  
	CONCAT('‡∏û‡∏µ‡πà',s.first_name,' ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ',m.first_order_date,' ‡∏ñ‡∏∂‡∏á ',MAX(CASE WHEN m.promo_num = 5 THEN date(m.end_datetime) END) ,
	  '<br/>‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡πà 1 ‡∏ß‡∏¥‡πà‡∏á‡πÑ‡∏õ ',MAX(CASE WHEN m.promo_num = 1 THEN m.total_order END), ' ‡∏á‡∏≤‡∏ô ‡πÑ‡∏î‡πâ‡πÇ‡∏ö‡∏ô‡∏±‡∏™ ', MAX(CASE WHEN m.promo_num = 1 THEN m.total_bonus END) ,' ‡∏ö‡∏≤‡∏ó', 
	  '<br/>‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡πà 2 ‡∏ß‡∏¥‡πà‡∏á‡πÑ‡∏õ ',MAX(CASE WHEN m.promo_num = 2 THEN m.total_order END),' ‡∏á‡∏≤‡∏ô ‡πÑ‡∏î‡πâ‡πÇ‡∏ö‡∏ô‡∏±‡∏™ ', MAX(CASE WHEN m.promo_num = 2 THEN m.total_bonus END) ,' ‡∏ö‡∏≤‡∏ó',
	  '<br/>‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡πà 3 ‡∏ß‡∏¥‡πà‡∏á‡πÑ‡∏õ ', MAX(CASE WHEN m.promo_num = 3 THEN m.total_order END),' ‡∏á‡∏≤‡∏ô ‡πÑ‡∏î‡πâ‡πÇ‡∏ö‡∏ô‡∏±‡∏™ ', MAX(CASE WHEN m.promo_num = 3 THEN m.total_bonus END) ,' ‡∏ö‡∏≤‡∏ó',
      '<br/>‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡πà 3 ‡∏ß‡∏¥‡πà‡∏á‡πÑ‡∏õ ', MAX(CASE WHEN m.promo_num = 4 THEN m.total_order END),' ‡∏á‡∏≤‡∏ô ‡πÑ‡∏î‡πâ‡πÇ‡∏ö‡∏ô‡∏±‡∏™ ', MAX(CASE WHEN m.promo_num = 4 THEN m.total_bonus END) ,' ‡∏ö‡∏≤‡∏ó',
      '<br/>‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡πà 3 ‡∏ß‡∏¥‡πà‡∏á‡πÑ‡∏õ ', MAX(CASE WHEN m.promo_num = 5 THEN m.total_order END),' ‡∏á‡∏≤‡∏ô ‡πÑ‡∏î‡πâ‡πÇ‡∏ö‡∏ô‡∏±‡∏™ ', MAX(CASE WHEN m.promo_num = 5 THEN m.total_bonus END) ,' ‡∏ö‡∏≤‡∏ó', 
	  '<br/>‡∏£‡∏ß‡∏°‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ', SUM(m.total_bonus),' ‡∏ö‡∏≤‡∏ó'
	  '<br/>‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏ì ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà',DATE_FORMAT(now(), '%d/%m/%Y %H:%i')) AS contents_en,
   
   'https://storage.googleapis.com/skootar-project.appspot.com/mkt/New Drivers Dec 2025 Motor_150.png' AS thumbnail_th,
   'https://storage.googleapis.com/skootar-project.appspot.com/mkt/New Drivers Dec 2025 Motor_150.png' AS thumbnail_en,
   
   '' AS url,
		  

    	 TRUE as display_in_news,
       date_format(current_date, '%Y-%m-%d 23:59:59') AS display_end,
       FALSE as public_news,
   	 'news' as news_type

    
FROM motor_driver m LEFT JOIN tbl_skootar s ON s.skootar_id = m.skootar_id
WHERE 
	m.bonus_status = 1
	AND s.`status` >-1
GROUP BY m.skootar_id HAVING SUM(m.total_bonus)>0 	AND MAX(CASE WHEN m.promo_num = 5 THEN date(m.end_datetime) END) < CURRENT_DATE() ;


-- noti ‡∏Ñ‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏∑‡πâ‡∏≠	
SELECT 
	s.skootar_id,
	s.onesignal_id,
	'üéâ‡∏™‡∏£‡∏∏‡∏õ‡πÇ‡∏õ‡∏£‡∏Ø ‡∏¢‡∏¥‡πà‡∏á‡∏ß‡∏¥‡πà‡∏á ‡∏¢‡∏¥‡πà‡∏á‡πÑ‡∏î‡πâ ‡∏£‡∏±‡∏ö‡∏ü‡∏£‡∏µ‡πÄ‡∏™‡∏∑‡πâ‡∏≠ Skootar ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤ 500 ‡∏ö‡∏≤‡∏ó' AS heading_th,
	'üéâ‡∏™‡∏£‡∏∏‡∏õ‡πÇ‡∏õ‡∏£‡∏Ø ‡∏¢‡∏¥‡πà‡∏á‡∏ß‡∏¥‡πà‡∏á ‡∏¢‡∏¥‡πà‡∏á‡πÑ‡∏î‡πâ ‡∏£‡∏±‡∏ö‡∏ü‡∏£‡∏µ‡πÄ‡∏™‡∏∑‡πâ‡∏≠ Skootar ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤ 500 ‡∏ö‡∏≤‡∏ó' AS heading_en,


	CONCAT('‡∏û‡∏µ‡πà',s.first_name,' ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ',m.first_order_date,' ‡∏ñ‡∏∂‡∏á ',MAX(CASE WHEN m.promo_num = 6 THEN date(m.end_datetime) END) ,
	  '<br/>‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 7 ‡∏ß‡∏±‡∏ô ‡∏ß‡∏¥‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ',MAX(CASE WHEN m.promo_num = 6 THEN m.total_order END), ' ‡∏á‡∏≤‡∏ô ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏£‡∏±‡∏ö‡πÄ‡∏™‡∏∑‡πâ‡∏≠ ‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏£‡∏±‡∏ä‡∏ï‡πå‡∏†‡∏≤‡∏Ñ‡∏¢‡πå ‡∏ä‡∏±‡πâ‡∏ô 2 ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞'
	  '<br/>‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏ì ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà',DATE_FORMAT(now(), '%d/%m/%Y %H:%i')) AS contents_th,
	  
	CONCAT('‡∏û‡∏µ‡πà',s.first_name,' ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ',m.first_order_date,' ‡∏ñ‡∏∂‡∏á ',MAX(CASE WHEN m.promo_num = 6 THEN date(m.end_datetime) END) ,
	  '<br/>‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 7 ‡∏ß‡∏±‡∏ô ‡∏ß‡∏¥‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ',MAX(CASE WHEN m.promo_num = 6 THEN m.total_order END), ' ‡∏á‡∏≤‡∏ô ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏£‡∏±‡∏ö‡πÄ‡∏™‡∏∑‡πâ‡∏≠ ‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏£‡∏±‡∏ä‡∏ï‡πå‡∏†‡∏≤‡∏Ñ‡∏¢‡πå ‡∏ä‡∏±‡πâ‡∏ô 2 ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞'
	  '<br/>‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏ì ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà',DATE_FORMAT(now(), '%d/%m/%Y %H:%i'))  AS contents_en,

   '' AS thumbnail_th,
   '' AS thumbnail_en,
   ''AS URL,
	'TRUE' AS display_in_news,
	CONCAT( DATE_ADD( CURRENT_DATE(), INTERVAL 14 DAY), ' 23:59:59') AS display_end, 
   'FALSE' AS public_news,
   'news' AS news_type

FROM motor_driver m  LEFT JOIN tbl_skootar s ON m.skootar_id = s.skootar_id
WHERE evidence_status = 1
GROUP BY m.skootar_id HAVING MAX(CASE WHEN m.promo_num = 6 THEN m.total_bonus END) >0 AND MAX(CASE WHEN m.promo_num = 6 THEN m.bonus_status END) =1 AND  MAX(CASE WHEN m.promo_num = 6 THEN date(m.end_datetime) END) < CURRENT_DATE() ;


-- noti ‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á
SELECT 
	s.skootar_id,
	s.onesignal_id,
	'üéâ‡∏™‡∏£‡∏∏‡∏õ‡πÇ‡∏õ‡∏£‡∏Ø ‡∏¢‡∏¥‡πà‡∏á‡∏ß‡∏¥‡πà‡∏á ‡∏¢‡∏¥‡πà‡∏á‡πÑ‡∏î‡πâ ‡∏£‡∏±‡∏ö‡∏ü‡∏£‡∏µ‡∏Å‡∏•‡πà‡∏≠‡∏á Skootar ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤ 990 ‡∏ö‡∏≤‡∏ó' AS heading_th,
	'üéâ‡∏™‡∏£‡∏∏‡∏õ‡πÇ‡∏õ‡∏£‡∏Ø ‡∏¢‡∏¥‡πà‡∏á‡∏ß‡∏¥‡πà‡∏á ‡∏¢‡∏¥‡πà‡∏á‡πÑ‡∏î‡πâ ‡∏£‡∏±‡∏ö‡∏ü‡∏£‡∏µ‡∏Å‡∏•‡πà‡∏≠‡∏á Skootar ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤ 990 ‡∏ö‡∏≤‡∏ó' AS heading_en,


	CONCAT ('‡∏û‡∏µ‡πà',s.first_name,' ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ',first_order_date,' ‡∏ñ‡∏∂‡∏á ', MAX(CASE WHEN m.promo_num = 7 THEN date(m.end_datetime) END),
	  '<br/>‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 30 ‡∏ß‡∏±‡∏ô ‡∏ß‡∏¥‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ',MAX(CASE WHEN m.promo_num = 7 THEN m.total_order END), ' ‡∏á‡∏≤‡∏ô ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á ‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏£‡∏±‡∏ä‡∏ï‡πå‡∏†‡∏≤‡∏Ñ‡∏¢‡πå ‡∏ä‡∏±‡πâ‡∏ô 2 ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞'
	  '<br/>‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏ì ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà',DATE_FORMAT(now(), '%d/%m/%Y %H:%i')) AS contents_th,
	  
	CONCAT ('‡∏û‡∏µ‡πà',s.first_name,' ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ',first_order_date,' ‡∏ñ‡∏∂‡∏á ', MAX(CASE WHEN m.promo_num = 7 THEN date(m.end_datetime) END),
	  '<br/>‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 30 ‡∏ß‡∏±‡∏ô ‡∏ß‡∏¥‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ',MAX(CASE WHEN m.promo_num = 7 THEN m.total_order END), ' ‡∏á‡∏≤‡∏ô ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á ‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏£‡∏±‡∏ä‡∏ï‡πå‡∏†‡∏≤‡∏Ñ‡∏¢‡πå ‡∏ä‡∏±‡πâ‡∏ô 2 ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞'
	  '<br/>‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏ì ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà',DATE_FORMAT(now(), '%d/%m/%Y %H:%i')) AS contents_en,

   '' AS thumbnail_th,
   '' AS thumbnail_en,
   ''AS URL,
	'TRUE' AS display_in_news,
	CONCAT( DATE_ADD( CURRENT_DATE(), INTERVAL 14 DAY), ' 23:59:59') AS display_end, 
   'FALSE' AS public_news,
   'news' AS news_type

FROM motor_driver m  LEFT JOIN tbl_skootar s ON m.skootar_id = s.skootar_id
WHERE evidence_status = 1
GROUP BY m.skootar_id HAVING MAX(CASE WHEN m.promo_num = 7 THEN m.total_bonus END) >0 AND MAX(CASE WHEN m.promo_num = 7 THEN m.bonus_status END) =1 AND  MAX(CASE WHEN m.promo_num = 7 THEN date(m.end_datetime) END) < CURRENT_DATE() ;


-- list ‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏∑‡πâ‡∏≠
SELECT 
	s.skootar_id,
	s.first_name,
	s.mobile,
	first_order_date AS ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏¥‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏£‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà, 
	MAX(CASE WHEN m.promo_num = 6 THEN date(m.end_datetime) END) AS ‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡πÇ‡∏õ‡∏£‡πÅ‡∏à‡∏Å‡πÄ‡∏™‡∏∑‡πâ‡∏≠,
	MAX(CASE WHEN m.promo_num = 6 THEN m.total_order END) AS ‡∏ß‡∏¥‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

FROM motor_driver m LEFT JOIN tbl_skootar s ON m.skootar_id = s.skootar_id
WHERE evidence_status = 1
GROUP BY m.skootar_id HAVING MAX(CASE WHEN m.promo_num = 6 THEN m.total_bonus END) >0 AND MAX(CASE WHEN m.promo_num = 6 THEN m.bonus_status END) =1 AND  MAX(CASE WHEN m.promo_num = 6 THEN date(m.end_datetime) END) < CURRENT_DATE() ;


-- list ‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏•‡πà‡∏≠‡∏á
SELECT 
	s.skootar_id,
	s.first_name,
	s.mobile,
	first_order_date AS ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏¥‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏£‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà, 
	MAX(CASE WHEN m.promo_num = 7 THEN date(m.end_datetime) END) AS ‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡πÇ‡∏õ‡∏£‡πÅ‡∏à‡∏Å‡πÄ‡∏™‡∏∑‡πâ‡∏≠,
	MAX(CASE WHEN m.promo_num = 7 THEN m.total_order END) AS ‡∏ß‡∏¥‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

FROM motor_driver m LEFT JOIN tbl_skootar s ON m.skootar_id = s.skootar_id
WHERE evidence_status = 1
GROUP BY m.skootar_id HAVING MAX(CASE WHEN m.promo_num = 7 THEN m.total_bonus END) >0 AND MAX(CASE WHEN m.promo_num = 7 THEN m.bonus_status END) =1 AND  MAX(CASE WHEN m.promo_num = 7 THEN date(m.end_datetime) END) < CURRENT_DATE() ;
